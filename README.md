# SOKONEX MVP

Marketplace RDC "SOKONEX" - MVP

## Tech Stack
- **Frontend**: React (Vite), TypeScript, TailwindCSS, React Query
- **Backend**: Node.js, Express, TypeScript, MongoDB (Mongoose)
- **Files**: AWS S3 (Presigned URLs)

## Prerequisites
- Node.js (v18+)
- MongoDB (Local or Atlas)
- AWS S3 Bucket (CORS enabled for frontend domain)

## Setup Locally

### 1. Backend
```bash
cd backend
npm install
# Configure .env (see below)
npm run dev
```

**backend/.env**:
```env
PORT=5000
MONGO_URI=mongodb://localhost:27017/sokonex
JWT_SECRET=your_secret_key
FRONTEND_URL=http://localhost:5173
PHONE_VERIFICATION_MODE=test

# AWS S3
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_REGION=us-east-1
AWS_BUCKET_NAME=your_bucket_name
```

### 2. Frontend
```bash
cd frontend
npm install
npm run dev
```

**frontend/.env** (Optional if changing defaults):
```env
VITE_API_URL=http://localhost:5000/api
```

## Deployment

### Frontend (Vercel)
1. Import `frontend` repo.
2. Set Build Command: `npm run build`.
3. Set Output Directory: `dist`.
4. Add Env Vars if needed.

### Backend (Render / Railway)
1. Import `backend` repo.
2. Build Command: `npm install && npm run build`.
3. Start Command: `npm start` (Mapped to `node dist/index.js`).
4. Add Environment Variables from `.env`.

### Database (MongoDB Atlas)
1. Creating Cluster.
2. Whitelist IP (0.0.0.0/0 for simplified access or specific IPs).
3. Get Connection String for `MONGO_URI`.

### S3 Configuration (CORS)
Ensure your bucket CORS configuration allows PUT/GET from your frontend domain (and localhost).
```json
[
    {
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["GET", "PUT", "POST", "HEAD"],
        "AllowedOrigins": ["http://localhost:5173", "https://your-production-url.vercel.app"],
        "ExposeHeaders": []
    }
]
```

## Architecture Notes
- **Single Search Endpoint**: `/api/ads` handles all filtering, searching, and facets.
- **Image Uploads**: Frontend uploads directly to S3 using presigned URLs generated by `/api/uploads/presign`.
- **Validation**:
  - `isPhoneVerified` is required to post ads.
  - In `test` mode, verification is instant.
